# 優化演算法 Cheat Sheet
## 蜂群位置優化策略

### 核心概念

| 概念 | 說明 |
|------|------|
| **優化目標** | 最大化被阻斷的地面終端數量 |
| **決策變數** | 無人機位置 (緯度, 經度) |
| **約束條件** | 位置範圍限制、高度固定 |
| **適應度函數** | 被阻斷終端數量 |

### 優化問題定義

| 項目 | 說明 |
|------|------|
| **目標函數** | `f(x₁, y₁, ..., xₙ, yₙ) = jammed_count` |
| **決策變數** | `(x_i, y_i)` - 第 i 架無人機的緯度、經度 |
| **約束** | `x_i ∈ [20°, 26°]`, `y_i ∈ [118°, 123°]` |
| **目標** | `maximize f()` |

### 粒子群優化 (PSO) 概念

| 參數 | 符號 | 說明 |
|------|------|------|
| 粒子位置 | `x_i(t)` | 第 i 個粒子在時刻 t 的位置 |
| 粒子速度 | `v_i(t)` | 第 i 個粒子的速度 |
| 個體最優 | `p_i` | 粒子 i 的歷史最佳位置 |
| 全局最優 | `g` | 所有粒子的全局最佳位置 |
| 慣性權重 | `w` | 速度更新權重 (0.5-0.9) |
| 學習因子 | `c₁, c₂` | 個體和全局學習係數 (1-2) |

### PSO 更新公式

| 更新 | 公式 | 說明 |
|------|------|------|
| **速度更新** | `v_i(t+1) = w*v_i(t) + c₁*r₁*(p_i - x_i(t)) + c₂*r₂*(g - x_i(t))` | 速度迭代 |
| **位置更新** | `x_i(t+1) = x_i(t) + v_i(t+1)` | 位置迭代 |

其中 `r₁, r₂` 為 [0,1] 隨機數

### 簡化優化策略 (本專案)

| 方法 | 說明 | 優點 | 缺點 |
|------|------|------|------|
| **隨機搜索** | 在當前位置附近隨機移動 | 簡單、快速 | 可能陷入局部最優 |
| **貪婪策略** | 接受更好的解 | 保證不變差 | 收斂慢 |
| **固定步長** | 每次移動固定距離 | 可控 | 可能跳過最優解 |

### 適應度函數計算

| 步驟 | 計算 | 說明 |
|------|------|------|
| 1. 計算所有終端 SINR | `SINR_i = f(positions, terminal_i)` | 對每個終端 |
| 2. 判斷阻斷狀態 | `jammed_i = (SINR_i < threshold)` | 布林值 |
| 3. 統計阻斷數量 | `fitness = Σ jammed_i` | 適應度值 |

### 在本專案中的實現

| 函數 | 功能 | 關鍵邏輯 |
|------|------|----------|
| `update_formation()` | 更新編隊 | 隨機搜索 + 貪婪接受 |
| `_calculate_fitness()` | 計算適應度 | 統計被阻斷終端數 |

### 優化流程

```
1. 初始化無人機位置
2. 計算當前適應度
3. 生成新位置（當前位置 + 隨機偏移）
4. 限制在合理範圍內
5. 計算新適應度
6. 如果新適應度 ≥ 當前適應度，接受新位置
7. 否則保持原位置
8. 重複步驟 3-7
```

### 參數設置

| 參數 | 典型值 | 說明 |
|------|--------|------|
| **步長** | 0.1° | 每次移動的最大距離 |
| **搜索範圍** | ±0.5° | 隨機搜索範圍 |
| **位置限制** | [20°, 26°] × [118°, 123°] | 台灣附近 |
| **優化頻率** | 每 5 個時間步 | 降低計算量 |

### 優化策略比較

| 策略 | 收斂速度 | 全局最優 | 計算複雜度 |
|------|---------|---------|-----------|
| **隨機搜索** | 慢 | 可能 | O(n) |
| **貪婪** | 中等 | 否 | O(n) |
| **完整 PSO** | 快 | 可能 | O(n²) |
| **遺傳演算法** | 中等 | 可能 | O(n²) |
| **強化學習** | 慢（訓練） | 可能 | O(n³) |

### 改進建議

| 改進 | 方法 | 說明 |
|------|------|------|
| **多起點搜索** | 從多個初始位置開始 | 避免局部最優 |
| **自適應步長** | 根據適應度變化調整 | 提高收斂速度 |
| **協同優化** | 考慮無人機間協作 | 避免重疊覆蓋 |
| **預測優化** | 預測衛星未來位置 | 提前調整 |

### 性能指標

| 指標 | 計算 | 說明 |
|------|------|------|
| **收斂速度** | 達到目標適應度的迭代次數 | 優化效率 |
| **最終適應度** | 優化後的阻斷數量 | 優化效果 |
| **穩定性** | 多次運行的方差 | 結果可靠性 |

### 約束處理

| 約束類型 | 處理方法 | 說明 |
|---------|---------|------|
| **邊界約束** | `np.clip()` | 限制在範圍內 |
| **高度約束** | 固定高度 20 km | 不作為決策變數 |
| **碰撞避免** | 最小距離限制 | 防止無人機過近 |

### 範例代碼結構

```python
def update_formation(self, ground_terminals, ...):
    # 1. 計算當前適應度
    current_fitness = self._calculate_fitness(...)
    
    # 2. 生成新位置
    step_size = 0.1
    new_positions = self.positions + (
        np.random.rand(n, 2) - 0.5
    ) * step_size
    
    # 3. 應用約束
    new_positions = np.clip(new_positions, min_val, max_val)
    
    # 4. 計算新適應度
    new_fitness = self._calculate_fitness(new_positions, ...)
    
    # 5. 貪婪接受
    if new_fitness >= current_fitness:
        self.positions = new_positions
        return new_fitness
    else:
        return current_fitness
```

### 注意事項

| 項目 | 說明 |
|------|------|
| **局部最優** | 簡單策略可能陷入局部最優 |
| **計算成本** | 每次適應度計算需要完整鏈路預算 |
| **收斂判斷** | 需要設置停止條件 |
| **參數調優** | 步長、搜索範圍需要根據問題調整 |

### 進階方法

| 方法 | 適用場景 | 複雜度 |
|------|---------|--------|
| **模擬退火** | 全局優化 | 中等 |
| **遺傳演算法** | 離散優化 | 高 |
| **蟻群演算法** | 路徑優化 | 高 |
| **強化學習** | 動態環境 | 很高 |

