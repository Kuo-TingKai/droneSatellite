# 座標系統轉換 Cheat Sheet
## 地理座標與 ECEF 座標

### 座標系統類型

| 座標系 | 說明 | 應用場景 |
|--------|------|---------|
| **地理座標 (Geographic)** | 緯度、經度、高度 | 地圖顯示、GPS |
| **ECEF** | Earth-Centered, Earth-Fixed | 3D 空間計算 |
| **ITRS** | International Terrestrial Reference System | 衛星軌道計算 |
| **本地座標** | 相對於某點的座標 | 局部計算 |

### 地理座標 (Geographic)

| 參數 | 符號 | 範圍 | 單位 |
|------|------|------|------|
| 緯度 | `lat` | -90° 到 +90° | 度 |
| 經度 | `lon` | -180° 到 +180° | 度 |
| 高度 | `alt` | 通常 0 到數百公里 | 米 |

### ECEF 座標 (Earth-Centered, Earth-Fixed)

| 參數 | 符號 | 說明 | 單位 |
|------|------|------|------|
| X | `x` | 指向本初子午線與赤道交點 | 米 |
| Y | `y` | 指向東經 90° 與赤道交點 | 米 |
| Z | `z` | 指向北極 | 米 |

### 轉換公式

#### 地理座標 → ECEF

| 公式 | 說明 |
|------|------|
| `x = (R + h) * cos(lat) * cos(lon)` | X 座標 |
| `y = (R + h) * cos(lat) * sin(lon)` | Y 座標 |
| `z = (R + h) * sin(lat)` | Z 座標 |

其中：
- `R = 6,371,000 m` (地球半徑)
- `h` = 高度 (米)
- `lat`, `lon` = 緯度、經度 (弧度)

#### ECEF → 地理座標 (簡化)

| 公式 | 說明 |
|------|------|
| `r = √(x² + y² + z²)` | 距離地心距離 |
| `lat = arcsin(z / r)` | 緯度 |
| `lon = arctan2(y, x)` | 經度 |
| `alt = r - R` | 高度 |

### 在本專案中的實現

| 函數 | 功能 | 代碼 |
|------|------|------|
| `geo_to_ecef()` | 地理→ECEF | `x = R * cos(lat_rad) * cos(lon_rad)` |
| `ecef_to_geo()` | ECEF→地理 | `lat = arcsin(z / r)` |

### 角度轉換

| 轉換 | 公式 | NumPy 函數 |
|------|------|-----------|
| 度→弧度 | `rad = deg * π / 180` | `np.deg2rad(deg)` |
| 弧度→度 | `deg = rad * 180 / π` | `np.rad2deg(rad)` |

### 距離計算

| 方法 | 公式 | NumPy 實現 |
|------|------|-----------|
| **3D 歐幾里得距離** | `d = √[(x₂-x₁)² + (y₂-y₁)² + (z₂-z₁)²]` | `np.linalg.norm(coord1 - coord2)` |
| **地理距離 (大圓)** | `d = R * arccos(sin(lat1)*sin(lat2) + cos(lat1)*cos(lat2)*cos(Δlon))` | Haversine 公式 |

### 典型座標值

| 位置 | 緯度 | 經度 | ECEF (近似, 米) |
|------|------|------|----------------|
| **台北** | 25.0330° | 121.5654° | (2,825,000, 4,650,000, 2,800,000) |
| **台灣中心** | 23.5° | 120.5° | (2,850,000, 4,700,000, 2,750,000) |
| **LEO 衛星** | - | - | 高度約 6,921,000 m (550 km) |
| **無人機** | - | - | 高度約 6,391,000 m (20 km) |

### 座標系統比較

| 特性 | 地理座標 | ECEF |
|------|---------|------|
| **維度** | 3D (lat, lon, alt) | 3D (x, y, z) |
| **原點** | 地心 | 地心 |
| **單位** | 度、米 | 米 |
| **適用** | 地圖、導航 | 3D 計算、距離 |
| **轉換** | 需要三角函數 | 直接計算 |

### 計算範例

```python
import numpy as np

# 地球半徑
R = 6371000.0  # 米

# 地理座標 (台北)
lat = 25.0330  # 度
lon = 121.5654  # 度
alt = 0.0  # 米

# 轉換為弧度
lat_rad = np.deg2rad(lat)
lon_rad = np.deg2rad(lon)

# 轉換為 ECEF
x = (R + alt) * np.cos(lat_rad) * np.cos(lon_rad)
y = (R + alt) * np.cos(lat_rad) * np.sin(lon_rad)
z = (R + alt) * np.sin(lat_rad)

print(f"ECEF: ({x:.2f}, {y:.2f}, {z:.2f}) 米")

# ECEF → 地理座標
r = np.sqrt(x**2 + y**2 + z**2)
lat_back = np.rad2deg(np.arcsin(z / r))
lon_back = np.rad2deg(np.arctan2(y, x))
alt_back = r - R

print(f"地理座標: ({lat_back:.4f}°, {lon_back:.4f}°, {alt_back:.2f}m)")
```

### 注意事項

| 項目 | 說明 |
|------|------|
| **地球扁率** | 簡化模型假設地球為完美球體，實際為橢球 |
| **精度** | 簡化模型精度約數百米，高精度需 WGS84 |
| **高度定義** | 高度相對於海平面或地心，需明確 |
| **角度範圍** | 經度 -180° 到 +180°，緯度 -90° 到 +90° |
| **符號約定** | 北緯為正，東經為正 |

### 高精度模型 (WGS84)

| 參數 | 值 | 說明 |
|------|-----|------|
| 長半軸 | `a = 6,378,137 m` | 赤道半徑 |
| 短半軸 | `b = 6,356,752.314 m` | 極半徑 |
| 扁率 | `f = (a-b)/a = 1/298.257` | 地球扁率 |

### 在本專案中的應用

| 用途 | 實現 |
|------|------|
| **地面終端位置** | 地理座標 → ECEF |
| **無人機位置** | 地理座標 → ECEF (高度 20 km) |
| **衛星位置** | Skyfield 直接提供 ECEF |
| **距離計算** | ECEF 座標間歐幾里得距離 |

### 常見錯誤

| 錯誤 | 原因 | 解決方案 |
|------|------|---------|
| 角度未轉換 | 使用度數而非弧度 | 使用 `np.deg2rad()` |
| 符號錯誤 | 經緯度符號混淆 | 檢查北緯/南緯、東經/西經 |
| 高度忽略 | 未考慮高度 | 使用 `R + alt` |
| 單位混用 | 米和公里混用 | 統一使用米 |

